"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global Sentry, globalPBXVersion, globalPBXLicense,
globalLastSentryEventId, globalTranslate, localStorage */

/**
 * Shows the Sentry report dialog for error reporting.
 * @param {string} hash - Hash value for identifying the error.
 * @param {string} sentryEventId - Sentry event ID for the error.
 */
function globalShowSentryReportDialog(hash, sentryEventId) {
  var itIsKnownError = localStorage.getItem("sentry_lastError".concat(hash));

  if (itIsKnownError === null) {
    if (typeof {
      globalTranslate: globalTranslate
    } !== "undefined" && Object.keys(globalTranslate).length > 0) {
      Sentry.showReportDialog({
        eventId: sentryEventId,
        title: globalTranslate.sntry_Title,
        subtitle: globalTranslate.sntry_Subtitle,
        subtitle2: globalTranslate.sntry_Subtitle2,
        labelComments: globalTranslate.sntry_LabelComments,
        labelClose: globalTranslate.sntry_LabelClose,
        labelSubmit: globalTranslate.sntry_LabelSubmit,
        errorGeneric: globalTranslate.sntry_ErrorGeneric,
        errorFormEntry: globalTranslate.sntry_ErrorFormEntry,
        successMessage: globalTranslate.sntry_SuccessMessage
      });
    } else {
      Sentry.showReportDialog({
        eventId: sentryEventId
      });
    }

    localStorage.setItem("sentry_lastError".concat(hash), 'theFormHasAlreadySent');
  }
}

Sentry.onLoad(function () {
  Sentry.init({
    dsn: 'https://07be0eff8a5c463fbac3e90ae5c7d039@sentry.miko.ru/1',
    release: "mikopbx@".concat(globalPBXVersion),
    beforeSend: function beforeSend(event, hint) {
      // Check if it is an exception, and if so, show the report dialog
      if (event.exception) {
        var error = hint.originalException;

        if (error && error.message && error.message.length > 0) {
          // Log the error message to the console
          console.error("Captured error:", error); // Generate a hash from the error message

          var s = error.message;
          var hash = 0;
          var i;
          var chr;

          for (i = 0; i < s.length; i++) {
            chr = s.charCodeAt(i);
            hash = (hash << 5) - hash + chr;
            hash |= 0; // Convert to 32bit integer
          } // Show the Sentry report dialog


          globalShowSentryReportDialog(hash, hint.eventId);
        }
      } // Return the event for Sentry to process


      return event;
    }
  });
  Sentry.configureScope(function (scope) {
    scope.setUser({
      id: globalPBXLicense
    });
    scope.setTag('library', 'web-interface');
  });

  if (globalLastSentryEventId) {
    globalShowSentryReportDialog(globalLastSentryEventId);
  }
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluL3NlbnRyeS1lcnJvci1sb2dnZXIuanMiXSwibmFtZXMiOlsiZ2xvYmFsU2hvd1NlbnRyeVJlcG9ydERpYWxvZyIsImhhc2giLCJzZW50cnlFdmVudElkIiwiaXRJc0tub3duRXJyb3IiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiZ2xvYmFsVHJhbnNsYXRlIiwiT2JqZWN0Iiwia2V5cyIsImxlbmd0aCIsIlNlbnRyeSIsInNob3dSZXBvcnREaWFsb2ciLCJldmVudElkIiwidGl0bGUiLCJzbnRyeV9UaXRsZSIsInN1YnRpdGxlIiwic250cnlfU3VidGl0bGUiLCJzdWJ0aXRsZTIiLCJzbnRyeV9TdWJ0aXRsZTIiLCJsYWJlbENvbW1lbnRzIiwic250cnlfTGFiZWxDb21tZW50cyIsImxhYmVsQ2xvc2UiLCJzbnRyeV9MYWJlbENsb3NlIiwibGFiZWxTdWJtaXQiLCJzbnRyeV9MYWJlbFN1Ym1pdCIsImVycm9yR2VuZXJpYyIsInNudHJ5X0Vycm9yR2VuZXJpYyIsImVycm9yRm9ybUVudHJ5Iiwic250cnlfRXJyb3JGb3JtRW50cnkiLCJzdWNjZXNzTWVzc2FnZSIsInNudHJ5X1N1Y2Nlc3NNZXNzYWdlIiwic2V0SXRlbSIsIm9uTG9hZCIsImluaXQiLCJkc24iLCJyZWxlYXNlIiwiZ2xvYmFsUEJYVmVyc2lvbiIsImJlZm9yZVNlbmQiLCJldmVudCIsImhpbnQiLCJleGNlcHRpb24iLCJlcnJvciIsIm9yaWdpbmFsRXhjZXB0aW9uIiwibWVzc2FnZSIsImNvbnNvbGUiLCJzIiwiaSIsImNociIsImNoYXJDb2RlQXQiLCJjb25maWd1cmVTY29wZSIsInNjb3BlIiwic2V0VXNlciIsImlkIiwiZ2xvYmFsUEJYTGljZW5zZSIsInNldFRhZyIsImdsb2JhbExhc3RTZW50cnlFdmVudElkIl0sIm1hcHBpbmdzIjoiOztBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNB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QXlCcEI7OztBQUNBLGFBQU8wQixLQUFQO0FBQ0g7QUE5Qk8sR0FBWjtBQWlDQTVCLEVBQUFBLE1BQU0sQ0FBQ3VDLGNBQVAsQ0FBc0IsVUFBQ0MsS0FBRCxFQUFXO0FBQzdCQSxJQUFBQSxLQUFLLENBQUNDLE9BQU4sQ0FBYztBQUFDQyxNQUFBQSxFQUFFLEVBQUVDO0FBQUwsS0FBZDtBQUNBSCxJQUFBQSxLQUFLLENBQUNJLE1BQU4sQ0FBYSxTQUFiLEVBQXdCLGVBQXhCO0FBQ0gsR0FIRDs7QUFLQSxNQUFJQyx1QkFBSixFQUE2QjtBQUN6QnZELElBQUFBLDRCQUE0QixDQUFDdUQsdUJBQUQsQ0FBNUI7QUFDSDtBQUNKLENBMUNEIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIE1pa29QQlggLSBmcmVlIHBob25lIHN5c3RlbSBmb3Igc21hbGwgYnVzaW5lc3NcbiAqIENvcHlyaWdodCDCqSAyMDE3LTIwMjMgQWxleGV5IFBvcnRub3YgYW5kIE5pa29sYXkgQmVrZXRvdlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBmcmVlIHNvZnR3YXJlOiB5b3UgY2FuIHJlZGlzdHJpYnV0ZSBpdCBhbmQvb3IgbW9kaWZ5XG4gKiBpdCB1bmRlciB0aGUgdGVybXMgb2YgdGhlIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGFzIHB1Ymxpc2hlZCBieVxuICogdGhlIEZyZWUgU29mdHdhcmUgRm91bmRhdGlvbjsgZWl0aGVyIHZlcnNpb24gMyBvZiB0aGUgTGljZW5zZSwgb3JcbiAqIChhdCB5b3VyIG9wdGlvbikgYW55IGxhdGVyIHZlcnNpb24uXG4gKlxuICogVGhpcyBwcm9ncmFtIGlzIGRpc3RyaWJ1dGVkIGluIHRoZSBob3BlIHRoYXQgaXQgd2lsbCBiZSB1c2VmdWwsXG4gKiBidXQgV0lUSE9VVCBBTlkgV0FSUkFOVFk7IHdpdGhvdXQgZXZlbiB0aGUgaW1wbGllZCB3YXJyYW50eSBvZlxuICogTUVSQ0hBTlRBQklMSVRZIG9yIEZJVE5FU1MgRk9SIEEgUEFSVElDVUxBUiBQVVJQT1NFLiAgU2VlIHRoZVxuICogR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgZm9yIG1vcmUgZGV0YWlscy5cbiAqXG4gKiBZb3Ugc2hvdWxkIGhhdmUgcmVjZWl2ZWQgYSBjb3B5IG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhbG9uZyB3aXRoIHRoaXMgcHJvZ3JhbS5cbiAqIElmIG5vdCwgc2VlIDxodHRwczovL3d3dy5nbnUub3JnL2xpY2Vuc2VzLz4uXG4gKi9cblxuXG4vKiBnbG9iYWwgU2VudHJ5LCBnbG9iYWxQQlhWZXJzaW9uLCBnbG9iYWxQQlhMaWNlbnNlLFxuZ2xvYmFsTGFzdFNlbnRyeUV2ZW50SWQsIGdsb2JhbFRyYW5zbGF0ZSwgbG9jYWxTdG9yYWdlICovXG5cbi8qKlxuICogU2hvd3MgdGhlIFNlbnRyeSByZXBvcnQgZGlhbG9nIGZvciBlcnJvciByZXBvcnRpbmcuXG4gKiBAcGFyYW0ge3N0cmluZ30gaGFzaCAtIEhhc2ggdmFsdWUgZm9yIGlkZW50aWZ5aW5nIHRoZSBlcnJvci5cbiAqIEBwYXJhbSB7c3RyaW5nfSBzZW50cnlFdmVudElkIC0gU2VudHJ5IGV2ZW50IElEIGZvciB0aGUgZXJyb3IuXG4gKi9cbmZ1bmN0aW9uIGdsb2JhbFNob3dTZW50cnlSZXBvcnREaWFsb2coaGFzaCwgc2VudHJ5RXZlbnRJZCkge1xuICAgIGNvbnN0IGl0SXNLbm93bkVycm9yID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oYHNlbnRyeV9sYXN0RXJyb3Ike2hhc2h9YCk7XG4gICAgaWYgKGl0SXNLbm93bkVycm9yID09PSBudWxsKSB7XG4gICAgICAgIGlmICh0eXBlb2Yge2dsb2JhbFRyYW5zbGF0ZX0gIT09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgICAgICYmIE9iamVjdC5rZXlzKGdsb2JhbFRyYW5zbGF0ZSkubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgU2VudHJ5LnNob3dSZXBvcnREaWFsb2coe1xuICAgICAgICAgICAgICAgIGV2ZW50SWQ6IHNlbnRyeUV2ZW50SWQsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdsb2JhbFRyYW5zbGF0ZS5zbnRyeV9UaXRsZSxcbiAgICAgICAgICAgICAgICBzdWJ0aXRsZTogZ2xvYmFsVHJhbnNsYXRlLnNudHJ5X1N1YnRpdGxlLFxuICAgICAgICAgICAgICAgIHN1YnRpdGxlMjogZ2xvYmFsVHJhbnNsYXRlLnNudHJ5X1N1YnRpdGxlMixcbiAgICAgICAgICAgICAgICBsYWJlbENvbW1lbnRzOiBnbG9iYWxUcmFuc2xhdGUuc250cnlfTGFiZWxDb21tZW50cyxcbiAgICAgICAgICAgICAgICBsYWJlbENsb3NlOiBnbG9iYWxUcmFuc2xhdGUuc250cnlfTGFiZWxDbG9zZSxcbiAgICAgICAgICAgICAgICBsYWJlbFN1Ym1pdDogZ2xvYmFsVHJhbnNsYXRlLnNudHJ5X0xhYmVsU3VibWl0LFxuICAgICAgICAgICAgICAgIGVycm9yR2VuZXJpYzogZ2xvYmFsVHJhbnNsYXRlLnNudHJ5X0Vycm9yR2VuZXJpYyxcbiAgICAgICAgICAgICAgICBlcnJvckZvcm1FbnRyeTogZ2xvYmFsVHJhbnNsYXRlLnNudHJ5X0Vycm9yRm9ybUVudHJ5LFxuICAgICAgICAgICAgICAgIHN1Y2Nlc3NNZXNzYWdlOiBnbG9iYWxUcmFuc2xhdGUuc250cnlfU3VjY2Vzc01lc3NhZ2UsXG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgU2VudHJ5LnNob3dSZXBvcnREaWFsb2coe2V2ZW50SWQ6IHNlbnRyeUV2ZW50SWR9KTtcbiAgICAgICAgfVxuICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShgc2VudHJ5X2xhc3RFcnJvciR7aGFzaH1gLCAndGhlRm9ybUhhc0FscmVhZHlTZW50Jyk7XG4gICAgfVxufVxuXG5TZW50cnkub25Mb2FkKCgpID0+IHtcbiAgICBTZW50cnkuaW5pdCh7XG4gICAgICAgIGRzbjogJ2h0dHBzOi8vMDdiZTBlZmY4YTVjNDYzZmJhYzNlOTBhZTVjN2QwMzlAc2VudHJ5Lm1pa28ucnUvMScsXG4gICAgICAgIHJlbGVhc2U6IGBtaWtvcGJ4QCR7Z2xvYmFsUEJYVmVyc2lvbn1gLFxuICAgICAgICBiZWZvcmVTZW5kKGV2ZW50LCBoaW50KSB7XG4gICAgICAgICAgICAvLyBDaGVjayBpZiBpdCBpcyBhbiBleGNlcHRpb24sIGFuZCBpZiBzbywgc2hvdyB0aGUgcmVwb3J0IGRpYWxvZ1xuICAgICAgICAgICAgaWYgKGV2ZW50LmV4Y2VwdGlvbikge1xuICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yID0gaGludC5vcmlnaW5hbEV4Y2VwdGlvbjtcbiAgICAgICAgICAgICAgICBpZiAoZXJyb3IgJiYgZXJyb3IubWVzc2FnZSAmJiBlcnJvci5tZXNzYWdlLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAvLyBMb2cgdGhlIGVycm9yIG1lc3NhZ2UgdG8gdGhlIGNvbnNvbGVcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcihcIkNhcHR1cmVkIGVycm9yOlwiLCBlcnJvcik7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gR2VuZXJhdGUgYSBoYXNoIGZyb20gdGhlIGVycm9yIG1lc3NhZ2VcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcyA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgICAgICAgIGxldCBoYXNoID0gMDtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBjaHI7XG4gICAgICAgICAgICAgICAgICAgIGZvciAoaSA9IDA7IGkgPCBzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaHIgPSBzLmNoYXJDb2RlQXQoaSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNoID0gKChoYXNoIDw8IDUpIC0gaGFzaCkgKyBjaHI7XG4gICAgICAgICAgICAgICAgICAgICAgICBoYXNoIHw9IDA7IC8vIENvbnZlcnQgdG8gMzJiaXQgaW50ZWdlclxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gU2hvdyB0aGUgU2VudHJ5IHJlcG9ydCBkaWFsb2dcbiAgICAgICAgICAgICAgICAgICAgZ2xvYmFsU2hvd1NlbnRyeVJlcG9ydERpYWxvZyhoYXNoLCBoaW50LmV2ZW50SWQpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUmV0dXJuIHRoZSBldmVudCBmb3IgU2VudHJ5IHRvIHByb2Nlc3NcbiAgICAgICAgICAgIHJldHVybiBldmVudDtcbiAgICAgICAgfSxcbiAgICB9KTtcblxuICAgIFNlbnRyeS5jb25maWd1cmVTY29wZSgoc2NvcGUpID0+IHtcbiAgICAgICAgc2NvcGUuc2V0VXNlcih7aWQ6IGdsb2JhbFBCWExpY2Vuc2V9KTtcbiAgICAgICAgc2NvcGUuc2V0VGFnKCdsaWJyYXJ5JywgJ3dlYi1pbnRlcmZhY2UnKTtcbiAgICB9KTtcblxuICAgIGlmIChnbG9iYWxMYXN0U2VudHJ5RXZlbnRJZCkge1xuICAgICAgICBnbG9iYWxTaG93U2VudHJ5UmVwb3J0RGlhbG9nKGdsb2JhbExhc3RTZW50cnlFdmVudElkKTtcbiAgICB9XG59KTsiXX0=