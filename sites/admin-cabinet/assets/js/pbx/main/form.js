"use strict";

/*
 * MikoPBX - free phone system for small business
 * Copyright Â© 2017-2023 Alexey Portnov and Nikolay Beketov
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License along with this program.
 * If not, see <https://www.gnu.org/licenses/>.
 */

/* global globalRootUrl, globalTranslate */

/**
 * The Form object is responsible for sending forms data to backend
 *
 * @module Form
 */
var Form = {
  /**
   * jQuery object for the form.
   * @type {jQuery}
   */
  $formObj: '',

  /**
   * Validation rules for the form fields before submission.
   *
   * @type {object}
   */
  validateRules: {},

  /**
   * Dirty check field, for checking if something on the form was changed
   * @type {jQuery}
   */
  $dirrtyField: $('#dirrty'),
  url: '',
  cbBeforeSendForm: '',
  cbAfterSendForm: '',
  $submitButton: $('#submitbutton'),
  $dropdownSubmit: $('#dropdownSubmit'),
  $submitModeInput: $('input[name="submitMode"]'),
  processData: true,
  contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
  keyboardShortcuts: true,
  enableDirrity: true,
  afterSubmitIndexUrl: '',
  afterSubmitModifyUrl: '',
  oldFormValues: [],
  initialize: function initialize() {
    // Set up custom form validation rules
    Form.$formObj.form.settings.rules.notRegExp = Form.notRegExpValidateRule;
    Form.$formObj.form.settings.rules.specialCharactersExist = Form.specialCharactersExistValidateRule;

    if (Form.enableDirrity) {
      // Initialize dirrity if enabled
      Form.initializeDirrity();
    } // Handle click event on submit button


    Form.$submitButton.on('click', function (e) {
      e.preventDefault();
      if (Form.$submitButton.hasClass('loading')) return;
      if (Form.$submitButton.hasClass('disabled')) return; // Set up form validation and submit

      Form.$formObj.form({
        on: 'blur',
        fields: Form.validateRules,
        onSuccess: function onSuccess() {
          // Call submitForm() on successful validation
          Form.submitForm();
        },
        onFailure: function onFailure() {
          // Add error class to form on validation failure
          Form.$formObj.removeClass('error').addClass('error');
        }
      });
      Form.$formObj.form('validate form');
    }); // Handle dropdown submit

    if (Form.$dropdownSubmit.length > 0) {
      Form.$dropdownSubmit.dropdown({
        onChange: function onChange(value) {
          var translateKey = "bt_".concat(value);
          Form.$submitModeInput.val(value);
          Form.$submitButton.html("<i class=\"save icon\"></i> ".concat(globalTranslate[translateKey])).click();
        }
      });
    } // Prevent form submission on enter keypress


    Form.$formObj.on('submit', function (e) {
      e.preventDefault();
    });
  },

  /**
   * Initializes tracking of form changes.
   */
  initializeDirrity: function initializeDirrity() {
    Form.saveInitialValues();
    Form.setEvents();
    Form.$submitButton.addClass('disabled');
    Form.$dropdownSubmit.addClass('disabled');
  },

  /**
   * Saves the initial form values for comparison.
   */
  saveInitialValues: function saveInitialValues() {
    Form.oldFormValues = Form.$formObj.form('get values');
  },

  /**
   * Sets up event handlers for form objects.
   */
  setEvents: function setEvents() {
    Form.$formObj.find('input, select').change(function () {
      Form.checkValues();
    });
    Form.$formObj.find('input, textarea').on('keyup keydown blur', function () {
      Form.checkValues();
    });
    Form.$formObj.find('.ui.checkbox').on('click', function () {
      Form.checkValues();
    });
  },

  /**
   * Compares the old and new form values for changes.
   */
  checkValues: function checkValues() {
    var newFormValues = Form.$formObj.form('get values');

    if (JSON.stringify(Form.oldFormValues) === JSON.stringify(newFormValues)) {
      Form.$submitButton.addClass('disabled');
      Form.$dropdownSubmit.addClass('disabled');
    } else {
      Form.$submitButton.removeClass('disabled');
      Form.$dropdownSubmit.removeClass('disabled');
    }
  },

  /**
   *  Changes the value of '$dirrtyField' to trigger
   *  the 'change' form event and enable submit button.
   */
  dataChanged: function dataChanged() {
    if (Form.enableDirrity) {
      Form.$dirrtyField.val(Math.random());
      Form.$dirrtyField.trigger('change');
    }
  },

  /**
   * Submits the form to the server.
   */
  submitForm: function submitForm() {
    $.api({
      url: Form.url,
      on: 'now',
      method: 'POST',
      processData: Form.processData,
      contentType: Form.contentType,
      keyboardShortcuts: Form.keyboardShortcuts,

      /**
       * Executes before sending the request.
       * @param {object} settings - The API settings object.
       * @returns {object} - The modified API settings object.
       */
      beforeSend: function beforeSend(settings) {
        // Add 'loading' class to the submit button
        Form.$submitButton.addClass('loading'); // Call cbBeforeSendForm function and handle the result

        var cbBeforeSendResult = Form.cbBeforeSendForm(settings);

        if (cbBeforeSendResult === false) {
          // If cbBeforeSendForm returns false, remove 'loading' class and perform a 'shake' transition on the submit button
          Form.$submitButton.transition('shake').removeClass('loading');
        } else {
          // Iterate over cbBeforeSendResult data, trim string values, and exclude sensitive information from being modified
          $.each(cbBeforeSendResult.data, function (index, value) {
            if (index.indexOf('ecret') > -1 || index.indexOf('assword') > -1) return;
            if (typeof value === 'string') cbBeforeSendResult.data[index] = value.trim();
          });
        }

        return cbBeforeSendResult;
      },

      /**
       * Executes when the request is successful.
       * @param {object} response - The response object.
       */
      onSuccess: function onSuccess(response) {
        // Remove any existing AJAX messages
        $('.ui.message.ajax').remove(); // Iterate over response message and handle errors

        $.each(response.message, function (index, value) {
          if (index === 'error') {
            // If there is an error, perform a 'shake' transition on the submit button and add an error message after the form
            Form.$submitButton.transition('shake').removeClass('loading');
            Form.$formObj.after("<div class=\"ui ".concat(index, " message ajax\">").concat(value, "</div>"));
          }
        }); // Dispatch 'ConfigDataChanged' event

        var event = document.createEvent('Event');
        event.initEvent('ConfigDataChanged', false, true);
        window.dispatchEvent(event); // Call cbAfterSendForm function

        Form.cbAfterSendForm(response); // Check response conditions and perform necessary actions

        if (Form.checkSuccess(response)) {
          var submitMode = Form.$submitModeInput.val();
          var reloadPath = Form.getReloadPath(response); // Redirect based on submitMode and other conditions

          switch (submitMode) {
            case 'SaveSettings':
              // Redirect to the specified URL if conditions are met
              if (reloadPath.length > 0) {
                window.location = globalRootUrl + reloadPath;
              }

              break;

            case 'SaveSettingsAndAddNew':
              if (Form.afterSubmitModifyUrl.length > 1) {
                window.location = Form.afterSubmitModifyUrl;
              } else {
                var emptyUrl = window.location.href.split('modify');
                var action = 'modify';
                var prefixData = emptyUrl[1].split('/');

                if (prefixData.length > 0) {
                  action = action + prefixData[0];
                }

                if (emptyUrl.length > 1) {
                  window.location = "".concat(emptyUrl[0]).concat(action, "/");
                }
              }

              break;

            case 'SaveSettingsAndExit':
              if (Form.afterSubmitIndexUrl.length > 1) {
                window.location = Form.afterSubmitIndexUrl;
              } else {
                Form.redirectToAction('index');
              }

              break;

            default:
              if (reloadPath.length > 0) {
                // Redirect to the specified URL if conditions are met
                window.location = globalRootUrl + reloadPath;
              }

              break;
          }

          if (Form.enableDirrity) {
            // Initialize dirrity if conditions are met
            Form.initializeDirrity();
          }
        } // Remove 'loading' class from the submit button


        Form.$submitButton.removeClass('loading');
      },

      /**
       * Executes when the request fails.
       * @param {object} response - The response object.
       */
      onFailure: function onFailure(response) {
        // Add the response message after the form and perform a 'shake' transition on the submit button
        Form.$formObj.after(response);
        Form.$submitButton.transition('shake').removeClass('loading');
      }
    });
  },

  /**
   * Checks if the response is successful
   */
  checkSuccess: function checkSuccess(response) {
    return !!(response.success || response.result);
  },

  /**
   * Extracts reload path from response.
   */
  getReloadPath: function getReloadPath(response) {
    if (response.reload !== undefined && response.reload.length > 0) {
      return response.reload;
    }

    return '';
  },

  /**
   * Function to redirect to a specific action ('modify' or 'index')
   */
  redirectToAction: function redirectToAction(actionName) {
    var baseUrl = window.location.href.split('modify')[0];
    window.location = "".concat(baseUrl).concat(actionName, "/");
  },

  /**
   * Checks if the value does not match the regex pattern.
   * @param {string} value - The value to validate.
   * @param {RegExp} regex - The regex pattern to match against.
   * @returns {boolean} - True if the value does not match the regex, false otherwise.
   */
  notRegExpValidateRule: function notRegExpValidateRule(value, regex) {
    return value.match(regex) !== null;
  },

  /**
   * Checks if the value contains special characters.
   * @param {string} value - The value to validate.
   * @returns {boolean} - True if the value contains special characters, false otherwise.
   */
  specialCharactersExistValidateRule: function specialCharactersExistValidateRule(value) {
    return value.match(/[()$^;#"><,.%â@!+=_]/) === null;
  }
}; // export default Form;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9tYWluL2Zvcm0uanMiXSwibmFtZXMiOlsiRm9ybSIsIiRmb3JtT2JqIiwidmFsaWRhdGVSdWxlcyIsIiRkaXJydHlGaWVsZCIsIiQiLCJ1cmwiLCJjYkJlZm9yZVNlbmRGb3JtIiwiY2JBZnRlclNlbmRGb3JtIiwiJHN1Ym1pdEJ1dHRvbiIsIiRkcm9wZG93blN1Ym1pdCIsIiRzdWJtaXRNb2RlSW5wdXQiLCJwcm9jZXNzRGF0YSIsImNvbnRlbnRUeXBlIiwia2V5Ym9hcmRTaG9ydGN1dHMiLCJlbmFibGVEaXJyaXR5IiwiYWZ0ZXJTdWJtaXRJbmRleFVybCIsImFmdGVyU3VibWl0TW9kaWZ5VXJsIiwib2xkRm9ybVZhbHVlcyIsImluaXRpYWxpemUiLCJmb3JtIiwic2V0dGluZ3MiLCJydWxlcyIsIm5vdFJlZ0V4cCIsIm5vdFJlZ0V4cFZhbGlkYXRlUnVsZSIsInNwZWNpYWxDaGFyYWN0ZXJzRXhpc3QiLCJzcGVjaWFsQ2hhcmFjdGVyc0V4aXN0VmFsaWRhdGVSdWxlIiwiaW5pdGlhbGl6ZURpcnJpdHkiLCJvbiIsImUiLCJwcmV2ZW50RGVmYXVsdCIsImhhc0NsYXNzIiwiZmllbGRzIiwib25TdWNjZXNzIiwic3VibWl0Rm9ybSIsIm9uRmFpbHVyZSIsInJlbW92ZUNsYXNzIiwiYWRkQ2xhc3MiLCJsZW5ndGgiLCJkcm9wZG93biIsIm9uQ2hhbmdlIiwidmFsdWUiLCJ0cmFuc2xhdGVLZXkiLCJ2YWwiLCJodG1sIiwiZ2xvYmFsVHJhbnNsYXRlIiwiY2xpY2siLCJzYXZlSW5pdGlhbFZhbHVlcyIsInNldEV2ZW50cyIsImZpbmQiLCJjaGFuZ2UiLCJjaGVja1ZhbHVlcyIsIm5ld0Zvcm1WYWx1ZXMiLCJKU09OIiwic3RyaW5naWZ5IiwiZGF0YUNoYW5nZWQiLCJNYXRoIiwicmFuZG9tIiwidHJpZ2dlciIsImFwaSIsIm1ldGhvZCIsImJlZm9yZVNlbmQiLCJjYkJlZm9yZVNlbmRSZXN1bHQiLCJ0cmFuc2l0aW9uIiwiZWFjaCIsImRhdGEiLCJpbmRleCIsImluZGV4T2YiLCJ0cmltIiwicmVzcG9uc2UiLCJyZW1vdmUiLCJtZXNzYWdlIiwiYWZ0ZXIiLCJldmVudCIsImRvY3VtZW50IiwiY3JlYXRlRXZlbnQiLCJpbml0RXZlbnQiLCJ3aW5kb3ciLCJkaXNwYXRjaEV2ZW50IiwiY2hlY2tTdWNjZXNzIiwic3VibWl0TW9kZSIsInJlbG9hZFBhdGgiLCJnZXRSZWxvYWRQYXRoIiwibG9jYXRpb24iLCJnbG9iYWxSb290VXJsIiwiZW1wdHlVcmwiLCJocmVmIiwic3BsaXQiLCJhY3Rpb24iLCJwcmVmaXhEYXRhIiwicmVkaXJlY3RUb0FjdGlvbiIsInN1Y2Nlc3MiLCJyZXN1bHQiLCJyZWxvYWQiLCJ1bmRlZmluZWQiLCJhY3Rpb25OYW1lIiwiYmFzZVVybCIsInJlZ2V4IiwibWF0Y2giXSwibWFwcGluZ3MiOiI7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBTUEsSUFBSSxHQUFHO0FBRVQ7QUFDSjtBQUNBO0FBQ0E7QUFDSUMsRUFBQUEsUUFBUSxFQUFFLEVBTkQ7O0FBUVQ7QUFDSjtBQUNBO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxhQUFhLEVBQUUsRUFiTjs7QUFlVDtBQUNKO0FBQ0E7QUFDQTtBQUNJQyxFQUFBQSxZQUFZLEVBQUVDLENBQUMsQ0FBQyxTQUFELENBbkJOO0FBcUJUQyxFQUFBQSxHQUFHLEVBQUUsRUFyQkk7QUFzQlRDLEVBQUFBLGdCQUFnQixFQUFFLEVBdEJUO0FBdUJUQyxFQUFBQSxlQUFlLEVBQUUsRUF2QlI7QUF3QlRDLEVBQUFBLGFBQWEsRUFBRUosQ0FBQyxDQUFDLGVBQUQsQ0F4QlA7QUF5QlRLLEVBQUFBLGVBQWUsRUFBRUwsQ0FBQyxDQUFDLGlCQUFELENBekJUO0FBMEJUTSxFQUFBQSxnQkFBZ0IsRUFBRU4sQ0FBQyxDQUFD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aVRUO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDSXZFLEVBQUFBLGtDQXRUUyw4Q0FzVDBCZSxLQXRUMUIsRUFzVGlDO0FBQ3RDLFdBQU9BLEtBQUssQ0FBQ3lELEtBQU4sQ0FBWSxzQkFBWixNQUF3QyxJQUEvQztBQUNIO0FBeFRRLENBQWIsQyxDQTJUQSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBNaWtvUEJYIC0gZnJlZSBwaG9uZSBzeXN0ZW0gZm9yIHNtYWxsIGJ1c2luZXNzXG4gKiBDb3B5cmlnaHQgwqkgMjAxNy0yMDIzIEFsZXhleSBQb3J0bm92IGFuZCBOaWtvbGF5IEJla2V0b3ZcbiAqXG4gKiBUaGlzIHByb2dyYW0gaXMgZnJlZSBzb2Z0d2FyZTogeW91IGNhbiByZWRpc3RyaWJ1dGUgaXQgYW5kL29yIG1vZGlmeVxuICogaXQgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBHTlUgR2VuZXJhbCBQdWJsaWMgTGljZW5zZSBhcyBwdWJsaXNoZWQgYnlcbiAqIHRoZSBGcmVlIFNvZnR3YXJlIEZvdW5kYXRpb247IGVpdGhlciB2ZXJzaW9uIDMgb2YgdGhlIExpY2Vuc2UsIG9yXG4gKiAoYXQgeW91ciBvcHRpb24pIGFueSBsYXRlciB2ZXJzaW9uLlxuICpcbiAqIFRoaXMgcHJvZ3JhbSBpcyBkaXN0cmlidXRlZCBpbiB0aGUgaG9wZSB0aGF0IGl0IHdpbGwgYmUgdXNlZnVsLFxuICogYnV0IFdJVEhPVVQgQU5ZIFdBUlJBTlRZOyB3aXRob3V0IGV2ZW4gdGhlIGltcGxpZWQgd2FycmFudHkgb2ZcbiAqIE1FUkNIQU5UQUJJTElUWSBvciBGSVRORVNTIEZPUiBBIFBBUlRJQ1VMQVIgUFVSUE9TRS4gIFNlZSB0aGVcbiAqIEdOVSBHZW5lcmFsIFB1YmxpYyBMaWNlbnNlIGZvciBtb3JlIGRldGFpbHMuXG4gKlxuICogWW91IHNob3VsZCBoYXZlIHJlY2VpdmVkIGEgY29weSBvZiB0aGUgR05VIEdlbmVyYWwgUHVibGljIExpY2Vuc2UgYWxvbmcgd2l0aCB0aGlzIHByb2dyYW0uXG4gKiBJZiBub3QsIHNlZSA8aHR0cHM6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy8+LlxuICovXG5cbi8qIGdsb2JhbCBnbG9iYWxSb290VXJsLCBnbG9iYWxUcmFuc2xhdGUgKi9cblxuLyoqXG4gKiBUaGUgRm9ybSBvYmplY3QgaXMgcmVzcG9uc2libGUgZm9yIHNlbmRpbmcgZm9ybXMgZGF0YSB0byBiYWNrZW5kXG4gKlxuICogQG1vZHVsZSBGb3JtXG4gKi9cbmNvbnN0IEZvcm0gPSB7XG5cbiAgICAvKipcbiAgICAgKiBqUXVlcnkgb2JqZWN0IGZvciB0aGUgZm9ybS5cbiAgICAgKiBAdHlwZSB7alF1ZXJ5fVxuICAgICAqL1xuICAgICRmb3JtT2JqOiAnJyxcblxuICAgIC8qKlxuICAgICAqIFZhbGlkYXRpb24gcnVsZXMgZm9yIHRoZSBmb3JtIGZpZWxkcyBiZWZvcmUgc3VibWlzc2lvbi5cbiAgICAgKlxuICAgICAqIEB0eXBlIHtvYmplY3R9XG4gICAgICovXG4gICAgdmFsaWRhdGVSdWxlczoge30sXG5cbiAgICAvKipcbiAgICAgKiBEaXJ0eSBjaGVjayBmaWVsZCwgZm9yIGNoZWNraW5nIGlmIHNvbWV0aGluZyBvbiB0aGUgZm9ybSB3YXMgY2hhbmdlZFxuICAgICAqIEB0eXBlIHtqUXVlcnl9XG4gICAgICovXG4gICAgJGRpcnJ0eUZpZWxkOiAkKCcjZGlycnR5JyksXG5cbiAgICB1cmw6ICcnLFxuICAgIGNiQmVmb3JlU2VuZEZvcm06ICcnLFxuICAgIGNiQWZ0ZXJTZW5kRm9ybTogJycsXG4gICAgJHN1Ym1pdEJ1dHRvbjogJCgnI3N1Ym1pdGJ1dHRvbicpLFxuICAgICRkcm9wZG93blN1Ym1pdDogJCgnI2Ryb3Bkb3duU3VibWl0JyksXG4gICAgJHN1Ym1pdE1vZGVJbnB1dDogJCgnaW5wdXRbbmFtZT1cInN1Ym1pdE1vZGVcIl0nKSxcbiAgICBwcm9jZXNzRGF0YTogdHJ1ZSxcbiAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZDsgY2hhcnNldD1VVEYtOCcsXG4gICAga2V5Ym9hcmRTaG9ydGN1dHM6IHRydWUsXG4gICAgZW5hYmxlRGlycml0eTogdHJ1ZSxcbiAgICBhZnRlclN1Ym1pdEluZGV4VXJsOiAnJyxcbiAgICBhZnRlclN1Ym1pdE1vZGlmeVVybDogJycsXG4gICAgb2xkRm9ybVZhbHVlczogW10sXG4gICAgaW5pdGlhbGl6ZSgpIHtcbiAgICAgICAgLy8gU2V0IHVwIGN1c3RvbSBmb3JtIHZhbGlkYXRpb24gcnVsZXNcbiAgICAgICAgRm9ybS4kZm9ybU9iai5mb3JtLnNldHRpbmdzLnJ1bGVzLm5vdFJlZ0V4cCA9IEZvcm0ubm90UmVnRXhwVmFsaWRhdGVSdWxlO1xuICAgICAgICBGb3JtLiRmb3JtT2JqLmZvcm0uc2V0dGluZ3MucnVsZXMuc3BlY2lhbENoYXJhY3RlcnNFeGlzdCA9IEZvcm0uc3BlY2lhbENoYXJhY3RlcnNFeGlzdFZhbGlkYXRlUnVsZTtcblxuICAgICAgICBpZiAoRm9ybS5lbmFibGVEaXJyaXR5KSB7XG4gICAgICAgICAgICAvLyBJbml0aWFsaXplIGRpcnJpdHkgaWYgZW5hYmxlZFxuICAgICAgICAgICAgRm9ybS5pbml0aWFsaXplRGlycml0eSgpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gSGFuZGxlIGNsaWNrIGV2ZW50IG9uIHN1Ym1pdCBidXR0b25cbiAgICAgICAgRm9ybS4kc3VibWl0QnV0dG9uLm9uKCdjbGljaycsIChlKSA9PiB7XG4gICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBpZiAoRm9ybS4kc3VibWl0QnV0dG9uLmhhc0NsYXNzKCdsb2FkaW5nJykpIHJldHVybjtcbiAgICAgICAgICAgIGlmIChGb3JtLiRzdWJtaXRCdXR0b24uaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHJldHVybjtcblxuICAgICAgICAgICAgLy8gU2V0IHVwIGZvcm0gdmFsaWRhdGlvbiBhbmQgc3VibWl0XG4gICAgICAgICAgICBGb3JtLiRmb3JtT2JqXG4gICAgICAgICAgICAgICAgLmZvcm0oe1xuICAgICAgICAgICAgICAgICAgICBvbjogJ2JsdXInLFxuICAgICAgICAgICAgICAgICAgICBmaWVsZHM6IEZvcm0udmFsaWRhdGVSdWxlcyxcbiAgICAgICAgICAgICAgICAgICAgb25TdWNjZXNzKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQ2FsbCBzdWJtaXRGb3JtKCkgb24gc3VjY2Vzc2Z1bCB2YWxpZGF0aW9uXG4gICAgICAgICAgICAgICAgICAgICAgICBGb3JtLnN1Ym1pdEZvcm0oKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgb25GYWlsdXJlKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGVycm9yIGNsYXNzIHRvIGZvcm0gb24gdmFsaWRhdGlvbiBmYWlsdXJlXG4gICAgICAgICAgICAgICAgICAgICAgICBGb3JtLiRmb3JtT2JqLnJlbW92ZUNsYXNzKCdlcnJvcicpLmFkZENsYXNzKCdlcnJvcicpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgRm9ybS4kZm9ybU9iai5mb3JtKCd2YWxpZGF0ZSBmb3JtJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIC8vIEhhbmRsZSBkcm9wZG93biBzdWJtaXRcbiAgICAgICAgaWYgKEZvcm0uJGRyb3Bkb3duU3VibWl0Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIEZvcm0uJGRyb3Bkb3duU3VibWl0LmRyb3Bkb3duKHtcbiAgICAgICAgICAgICAgICBvbkNoYW5nZTogKHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZUtleSA9IGBidF8ke3ZhbHVlfWA7XG4gICAgICAgICAgICAgICAgICAgIEZvcm0uJHN1Ym1pdE1vZGVJbnB1dC52YWwodmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBGb3JtLiRzdWJtaXRCdXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKGA8aSBjbGFzcz1cInNhdmUgaWNvblwiPjwvaT4gJHtnbG9iYWxUcmFuc2xhdGVbdHJhbnNsYXRlS2V5XX1gKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmNsaWNrKCk7XG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gUHJldmVudCBmb3JtIHN1Ym1pc3Npb24gb24gZW50ZXIga2V5cHJlc3NcbiAgICAgICAgRm9ybS4kZm9ybU9iai5vbignc3VibWl0JywgKGUpID0+IHtcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIEluaXRpYWxpemVzIHRyYWNraW5nIG9mIGZvcm0gY2hhbmdlcy5cbiAgICAgKi9cbiAgICBpbml0aWFsaXplRGlycml0eSgpIHtcbiAgICAgICAgRm9ybS5zYXZlSW5pdGlhbFZhbHVlcygpO1xuICAgICAgICBGb3JtLnNldEV2ZW50cygpO1xuICAgICAgICBGb3JtLiRzdWJtaXRCdXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIEZvcm0uJGRyb3Bkb3duU3VibWl0LmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTYXZlcyB0aGUgaW5pdGlhbCBmb3JtIHZhbHVlcyBmb3IgY29tcGFyaXNvbi5cbiAgICAgKi9cbiAgICBzYXZlSW5pdGlhbFZhbHVlcygpIHtcbiAgICAgICAgRm9ybS5vbGRGb3JtVmFsdWVzID0gRm9ybS4kZm9ybU9iai5mb3JtKCdnZXQgdmFsdWVzJyk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIFNldHMgdXAgZXZlbnQgaGFuZGxlcnMgZm9yIGZvcm0gb2JqZWN0cy5cbiAgICAgKi9cbiAgICBzZXRFdmVudHMoKSB7XG4gICAgICAgIEZvcm0uJGZvcm1PYmouZmluZCgnaW5wdXQsIHNlbGVjdCcpLmNoYW5nZSgoKSA9PiB7XG4gICAgICAgICAgICBGb3JtLmNoZWNrVmFsdWVzKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBGb3JtLiRmb3JtT2JqLmZpbmQoJ2lucHV0LCB0ZXh0YXJlYScpLm9uKCdrZXl1cCBrZXlkb3duIGJsdXInLCAoKSA9PiB7XG4gICAgICAgICAgICBGb3JtLmNoZWNrVmFsdWVzKCk7XG4gICAgICAgIH0pO1xuICAgICAgICBGb3JtLiRmb3JtT2JqLmZpbmQoJy51aS5jaGVja2JveCcpLm9uKCdjbGljaycsICgpID0+IHtcbiAgICAgICAgICAgIEZvcm0uY2hlY2tWYWx1ZXMoKTtcbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIC8qKlxuICAgICAqIENvbXBhcmVzIHRoZSBvbGQgYW5kIG5ldyBmb3JtIHZhbHVlcyBmb3IgY2hhbmdlcy5cbiAgICAgKi9cbiAgICBjaGVja1ZhbHVlcygpIHtcbiAgICAgICAgY29uc3QgbmV3Rm9ybVZhbHVlcyA9IEZvcm0uJGZvcm1PYmouZm9ybSgnZ2V0IHZhbHVlcycpO1xuICAgICAgICBpZiAoSlNPTi5zdHJpbmdpZnkoRm9ybS5vbGRGb3JtVmFsdWVzKSA9PT0gSlNPTi5zdHJpbmdpZnkobmV3Rm9ybVZhbHVlcykpIHtcbiAgICAgICAgICAgIEZvcm0uJHN1Ym1pdEJ1dHRvbi5hZGRDbGFzcygnZGlzYWJsZWQnKTtcbiAgICAgICAgICAgIEZvcm0uJGRyb3Bkb3duU3VibWl0LmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgRm9ybS4kc3VibWl0QnV0dG9uLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuICAgICAgICAgICAgRm9ybS4kZHJvcGRvd25TdWJtaXQucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG4gICAgICAgIH1cbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogIENoYW5nZXMgdGhlIHZhbHVlIG9mICckZGlycnR5RmllbGQnIHRvIHRyaWdnZXJcbiAgICAgKiAgdGhlICdjaGFuZ2UnIGZvcm0gZXZlbnQgYW5kIGVuYWJsZSBzdWJtaXQgYnV0dG9uLlxuICAgICAqL1xuICAgIGRhdGFDaGFuZ2VkKCkge1xuICAgICAgICBpZiAoRm9ybS5lbmFibGVEaXJyaXR5KSB7XG4gICAgICAgICAgICBGb3JtLiRkaXJydHlGaWVsZC52YWwoTWF0aC5yYW5kb20oKSk7XG4gICAgICAgICAgICBGb3JtLiRkaXJydHlGaWVsZC50cmlnZ2VyKCdjaGFuZ2UnKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBTdWJtaXRzIHRoZSBmb3JtIHRvIHRoZSBzZXJ2ZXIuXG4gICAgICovXG4gICAgc3VibWl0Rm9ybSgpIHtcbiAgICAgICAgJC5hcGkoe1xuICAgICAgICAgICAgdXJsOiBGb3JtLnVybCxcbiAgICAgICAgICAgIG9uOiAnbm93JyxcbiAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IEZvcm0ucHJvY2Vzc0RhdGEsXG4gICAgICAgICAgICBjb250ZW50VHlwZTogRm9ybS5jb250ZW50VHlwZSxcbiAgICAgICAgICAgIGtleWJvYXJkU2hvcnRjdXRzOiBGb3JtLmtleWJvYXJkU2hvcnRjdXRzLFxuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEV4ZWN1dGVzIGJlZm9yZSBzZW5kaW5nIHRoZSByZXF1ZXN0LlxuICAgICAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IHNldHRpbmdzIC0gVGhlIEFQSSBzZXR0aW5ncyBvYmplY3QuXG4gICAgICAgICAgICAgKiBAcmV0dXJucyB7b2JqZWN0fSAtIFRoZSBtb2RpZmllZCBBUEkgc2V0dGluZ3Mgb2JqZWN0LlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBiZWZvcmVTZW5kKHNldHRpbmdzKSB7XG4gICAgICAgICAgICAgICAgLy8gQWRkICdsb2FkaW5nJyBjbGFzcyB0byB0aGUgc3VibWl0IGJ1dHRvblxuICAgICAgICAgICAgICAgIEZvcm0uJHN1Ym1pdEJ1dHRvbi5hZGRDbGFzcygnbG9hZGluZycpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2FsbCBjYkJlZm9yZVNlbmRGb3JtIGZ1bmN0aW9uIGFuZCBoYW5kbGUgdGhlIHJlc3VsdFxuICAgICAgICAgICAgICAgIGNvbnN0IGNiQmVmb3JlU2VuZFJlc3VsdCA9IEZvcm0uY2JCZWZvcmVTZW5kRm9ybShzZXR0aW5ncyk7XG4gICAgICAgICAgICAgICAgaWYgKGNiQmVmb3JlU2VuZFJlc3VsdCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gSWYgY2JCZWZvcmVTZW5kRm9ybSByZXR1cm5zIGZhbHNlLCByZW1vdmUgJ2xvYWRpbmcnIGNsYXNzIGFuZCBwZXJmb3JtIGEgJ3NoYWtlJyB0cmFuc2l0aW9uIG9uIHRoZSBzdWJtaXQgYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIEZvcm0uJHN1Ym1pdEJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgLnRyYW5zaXRpb24oJ3NoYWtlJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIEl0ZXJhdGUgb3ZlciBjYkJlZm9yZVNlbmRSZXN1bHQgZGF0YSwgdHJpbSBzdHJpbmcgdmFsdWVzLCBhbmQgZXhjbHVkZSBzZW5zaXRpdmUgaW5mb3JtYXRpb24gZnJvbSBiZWluZyBtb2RpZmllZFxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goY2JCZWZvcmVTZW5kUmVzdWx0LmRhdGEsIChpbmRleCwgdmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChpbmRleC5pbmRleE9mKCdlY3JldCcpID4gLTEgfHwgaW5kZXguaW5kZXhPZignYXNzd29yZCcpID4gLTEpIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnKSBjYkJlZm9yZVNlbmRSZXN1bHQuZGF0YVtpbmRleF0gPSB2YWx1ZS50cmltKCk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gY2JCZWZvcmVTZW5kUmVzdWx0O1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBFeGVjdXRlcyB3aGVuIHRoZSByZXF1ZXN0IGlzIHN1Y2Nlc3NmdWwuXG4gICAgICAgICAgICAgKiBAcGFyYW0ge29iamVjdH0gcmVzcG9uc2UgLSBUaGUgcmVzcG9uc2Ugb2JqZWN0LlxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICBvblN1Y2Nlc3MocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgYW55IGV4aXN0aW5nIEFKQVggbWVzc2FnZXNcbiAgICAgICAgICAgICAgICAkKCcudWkubWVzc2FnZS5hamF4JykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICAvLyBJdGVyYXRlIG92ZXIgcmVzcG9uc2UgbWVzc2FnZSBhbmQgaGFuZGxlIGVycm9yc1xuICAgICAgICAgICAgICAgICQuZWFjaChyZXNwb25zZS5tZXNzYWdlLCAoaW5kZXgsIHZhbHVlKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpbmRleCA9PT0gJ2Vycm9yJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSWYgdGhlcmUgaXMgYW4gZXJyb3IsIHBlcmZvcm0gYSAnc2hha2UnIHRyYW5zaXRpb24gb24gdGhlIHN1Ym1pdCBidXR0b24gYW5kIGFkZCBhbiBlcnJvciBtZXNzYWdlIGFmdGVyIHRoZSBmb3JtXG4gICAgICAgICAgICAgICAgICAgICAgICBGb3JtLiRzdWJtaXRCdXR0b24udHJhbnNpdGlvbignc2hha2UnKS5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgRm9ybS4kZm9ybU9iai5hZnRlcihgPGRpdiBjbGFzcz1cInVpICR7aW5kZXh9IG1lc3NhZ2UgYWpheFwiPiR7dmFsdWV9PC9kaXY+YCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyBEaXNwYXRjaCAnQ29uZmlnRGF0YUNoYW5nZWQnIGV2ZW50XG4gICAgICAgICAgICAgICAgY29uc3QgZXZlbnQgPSBkb2N1bWVudC5jcmVhdGVFdmVudCgnRXZlbnQnKTtcbiAgICAgICAgICAgICAgICBldmVudC5pbml0RXZlbnQoJ0NvbmZpZ0RhdGFDaGFuZ2VkJywgZmFsc2UsIHRydWUpO1xuICAgICAgICAgICAgICAgIHdpbmRvdy5kaXNwYXRjaEV2ZW50KGV2ZW50KTtcblxuICAgICAgICAgICAgICAgIC8vIENhbGwgY2JBZnRlclNlbmRGb3JtIGZ1bmN0aW9uXG4gICAgICAgICAgICAgICAgRm9ybS5jYkFmdGVyU2VuZEZvcm0ocmVzcG9uc2UpO1xuXG4gICAgICAgICAgICAgICAgLy8gQ2hlY2sgcmVzcG9uc2UgY29uZGl0aW9ucyBhbmQgcGVyZm9ybSBuZWNlc3NhcnkgYWN0aW9uc1xuICAgICAgICAgICAgICAgIGlmIChGb3JtLmNoZWNrU3VjY2VzcyhyZXNwb25zZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3VibWl0TW9kZSA9IEZvcm0uJHN1Ym1pdE1vZGVJbnB1dC52YWwoKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcmVsb2FkUGF0aCA9IEZvcm0uZ2V0UmVsb2FkUGF0aChyZXNwb25zZSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gUmVkaXJlY3QgYmFzZWQgb24gc3VibWl0TW9kZSBhbmQgb3RoZXIgY29uZGl0aW9uc1xuICAgICAgICAgICAgICAgICAgICBzd2l0Y2ggKHN1Ym1pdE1vZGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgJ1NhdmVTZXR0aW5ncyc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gUmVkaXJlY3QgdG8gdGhlIHNwZWNpZmllZCBVUkwgaWYgY29uZGl0aW9ucyBhcmUgbWV0XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHJlbG9hZFBhdGgubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBnbG9iYWxSb290VXJsICsgcmVsb2FkUGF0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdTYXZlU2V0dGluZ3NBbmRBZGROZXcnOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChGb3JtLmFmdGVyU3VibWl0TW9kaWZ5VXJsLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gRm9ybS5hZnRlclN1Ym1pdE1vZGlmeVVybDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zdCBlbXB0eVVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KCdtb2RpZnknKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGFjdGlvbiA9ICdtb2RpZnknO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgcHJlZml4RGF0YSA9IGVtcHR5VXJsWzFdLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChwcmVmaXhEYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFjdGlvbiA9IGFjdGlvbiArIHByZWZpeERhdGFbMF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGVtcHR5VXJsLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGAke2VtcHR5VXJsWzBdfSR7YWN0aW9ufS9gO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSAnU2F2ZVNldHRpbmdzQW5kRXhpdCc6XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEZvcm0uYWZ0ZXJTdWJtaXRJbmRleFVybC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IEZvcm0uYWZ0ZXJTdWJtaXRJbmRleFVybDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBGb3JtLnJlZGlyZWN0VG9BY3Rpb24oJ2luZGV4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVsb2FkUGF0aC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIFJlZGlyZWN0IHRvIHRoZSBzcGVjaWZpZWQgVVJMIGlmIGNvbmRpdGlvbnMgYXJlIG1ldFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBnbG9iYWxSb290VXJsICsgcmVsb2FkUGF0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgaWYgKEZvcm0uZW5hYmxlRGlycml0eSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gSW5pdGlhbGl6ZSBkaXJyaXR5IGlmIGNvbmRpdGlvbnMgYXJlIG1ldFxuICAgICAgICAgICAgICAgICAgICAgICAgRm9ybS5pbml0aWFsaXplRGlycml0eSgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vIFJlbW92ZSAnbG9hZGluZycgY2xhc3MgZnJvbSB0aGUgc3VibWl0IGJ1dHRvblxuICAgICAgICAgICAgICAgIEZvcm0uJHN1Ym1pdEJ1dHRvbi5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBFeGVjdXRlcyB3aGVuIHRoZSByZXF1ZXN0IGZhaWxzLlxuICAgICAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IHJlc3BvbnNlIC0gVGhlIHJlc3BvbnNlIG9iamVjdC5cbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgb25GYWlsdXJlKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gQWRkIHRoZSByZXNwb25zZSBtZXNzYWdlIGFmdGVyIHRoZSBmb3JtIGFuZCBwZXJmb3JtIGEgJ3NoYWtlJyB0cmFuc2l0aW9uIG9uIHRoZSBzdWJtaXQgYnV0dG9uXG4gICAgICAgICAgICAgICAgRm9ybS4kZm9ybU9iai5hZnRlcihyZXNwb25zZSk7XG4gICAgICAgICAgICAgICAgRm9ybS4kc3VibWl0QnV0dG9uXG4gICAgICAgICAgICAgICAgICAgIC50cmFuc2l0aW9uKCdzaGFrZScpXG4gICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygnbG9hZGluZycpO1xuICAgICAgICAgICAgfSxcblxuICAgICAgICB9KTtcbiAgICB9LFxuICAgIC8qKlxuICAgICAqIENoZWNrcyBpZiB0aGUgcmVzcG9uc2UgaXMgc3VjY2Vzc2Z1bFxuICAgICAqL1xuICAgIGNoZWNrU3VjY2VzcyhyZXNwb25zZSkge1xuICAgICAgICByZXR1cm4gISEocmVzcG9uc2Uuc3VjY2VzcyB8fCByZXNwb25zZS5yZXN1bHQpO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBFeHRyYWN0cyByZWxvYWQgcGF0aCBmcm9tIHJlc3BvbnNlLlxuICAgICAqL1xuICAgIGdldFJlbG9hZFBhdGgocmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlLnJlbG9hZCAhPT0gdW5kZWZpbmVkICYmIHJlc3BvbnNlLnJlbG9hZC5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UucmVsb2FkO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAnJztcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogRnVuY3Rpb24gdG8gcmVkaXJlY3QgdG8gYSBzcGVjaWZpYyBhY3Rpb24gKCdtb2RpZnknIG9yICdpbmRleCcpXG4gICAgICovXG4gICAgcmVkaXJlY3RUb0FjdGlvbihhY3Rpb25OYW1lKSB7XG4gICAgICAgIGNvbnN0IGJhc2VVcmwgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdCgnbW9kaWZ5JylbMF07XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGAke2Jhc2VVcmx9JHthY3Rpb25OYW1lfS9gO1xuICAgIH0sXG5cbiAgICAvKipcbiAgICAgKiBDaGVja3MgaWYgdGhlIHZhbHVlIGRvZXMgbm90IG1hdGNoIHRoZSByZWdleCBwYXR0ZXJuLlxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZSAtIFRoZSB2YWx1ZSB0byB2YWxpZGF0ZS5cbiAgICAgKiBAcGFyYW0ge1JlZ0V4cH0gcmVnZXggLSBUaGUgcmVnZXggcGF0dGVybiB0byBtYXRjaCBhZ2FpbnN0LlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSAtIFRydWUgaWYgdGhlIHZhbHVlIGRvZXMgbm90IG1hdGNoIHRoZSByZWdleCwgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIG5vdFJlZ0V4cFZhbGlkYXRlUnVsZSh2YWx1ZSwgcmVnZXgpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlLm1hdGNoKHJlZ2V4KSAhPT0gbnVsbDtcbiAgICB9LFxuXG4gICAgLyoqXG4gICAgICogQ2hlY2tzIGlmIHRoZSB2YWx1ZSBjb250YWlucyBzcGVjaWFsIGNoYXJhY3RlcnMuXG4gICAgICogQHBhcmFtIHtzdHJpbmd9IHZhbHVlIC0gVGhlIHZhbHVlIHRvIHZhbGlkYXRlLlxuICAgICAqIEByZXR1cm5zIHtib29sZWFufSAtIFRydWUgaWYgdGhlIHZhbHVlIGNvbnRhaW5zIHNwZWNpYWwgY2hhcmFjdGVycywgZmFsc2Ugb3RoZXJ3aXNlLlxuICAgICAqL1xuICAgIHNwZWNpYWxDaGFyYWN0ZXJzRXhpc3RWYWxpZGF0ZVJ1bGUodmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHZhbHVlLm1hdGNoKC9bKCkkXjsjXCI+PCwuJeKElkAhKz1fXS8pID09PSBudWxsO1xuICAgIH1cbn07XG5cbi8vIGV4cG9ydCBkZWZhdWx0IEZvcm07XG4iXX0=